---
title: "Data analysis"
author: "Mariane Modena"
format: html
---

```{r}
here::i_am("r-101-grade-analysis.Rproj")
library(dplyr)
library(ggplot2)
library(vroom)
```
## Question 1

```{r}
grades <- vroom("grades.csv")
```
## Question 2

```{r}
exam_grades <- 
  grades |>
  summarise('max'=max(Exam, na.rm=TRUE), 'min'=min(Exam, na.rm=TRUE), 'median'=median(Exam, na.rm=TRUE), 'mean'=mean(Exam, na.rm=TRUE))

knitr::kable(exam_grades, caption='Descriptive statistics on the grades received at the exam')
```
## Question 3

```{r}
NA_exam <- 
  grades |>
  filter(is.na(Exam))
```

`r nrow(NA_exam)` students didn't take the exam.

## Question 4

We first compute a dataset with no 'NA' values in the 'Exam' column from the grades dataset. Using this new dataset when plotting the distribution of the Exam grades avoids warnings from ggplot2.

```{r}
No_NA_exam <-
  grades |>
  filter(!is.na(Exam))
```


```{r}
ggplot(No_NA_exam, aes(x=Exam))+
  geom_bar()+
  scale_x_continuous(breaks = scales::pretty_breaks(n = 20))+
  labs(title='Distribution of the grades received at the exam', x='Exam grades' )
```
Note: we could also use a geom density, but it only captures the global shape of the distribution and therefore fails to highlight the lower counts of grades that end with '.5'.

## Question 5 

```{r}
students_per_group <-
  grades |>
  group_by(Group)|>
  summarise('Number of students'=n())
  
knitr::kable(students_per_group)
```

## Question 6 

we create a column with only the group number to have a more readable x axis when plotting.
```{r}
ggplot(
  grades |>
  mutate('Group number' = gsub("grp_", "", grades$Group)),
  aes(x=`Group number`))+
  geom_bar()+
  labs(title ='Number of students per group')

```

## Question 7

### First solution (boxplots)

```{r}
ggplot(
  No_NA_exam |>
  mutate('Group number' = gsub("grp_", "", No_NA_exam$Group)),
  aes(x=`Group number`, y=Exam))+
  geom_boxplot()+
  labs(title='Distribution of the grades received at the Exam conditionned by the group')
  
  
```

### Second solution (violins)

```{r}
ggplot(
  No_NA_exam |>
  mutate('Group number' = gsub("grp_", "", No_NA_exam$Group)),
  aes(x=`Group number`, y=Exam))+
  geom_violin(draw_quantiles = c(0.25, 0.75))+
  stat_summary(fun.y=median, geom='point', color='red')+
  labs(title='Distribution of the grades received at the Exam conditionned by the group')
```

## Question 8 

```{r}
NA_students_per_group <-
  grades |>
  group_by(`Group`)|>
  summarise('Number of NA (Exam)'=sum(is.na(Exam)))

knitr::kable(NA_students_per_group)

```

## Question 9

```{r}
ggplot(NA_students_per_group |>
       mutate('Group number' = gsub("grp_", "", NA_students_per_group$Group)),
       aes(x=`Group number`, y=`Number of NA (Exam)`))+
geom_col()+
labs(title='Number of students who did not take the exam per group')
       
```
## Question 10

```{r}
library(tidyr)
```

```{r}
long_grades <-
  grades |>
  pivot_longer(cols=-c('Id','Group'), names_to='name')

long_grades
```

## Question 11

```{r}
missing_grades_per_student <-
  long_grades |>
  group_by(Id) |>
  summarise('Missing grades'=sum(is.na(value)))

missing_grades_per_student
```

